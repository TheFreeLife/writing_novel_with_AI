<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>소설 작성 에디터</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Noto+Sans+CJK+KR:wght@400;700&family=Noto+Serif+CJK+KR:wght@400;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <button id="theme-toggle" title="테마 전환">
        <svg id="sun-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="hidden">
            <circle cx="12" cy="12" r="5"></circle>
            <line x1="12" y1="1" x2="12" y2="3"></line>
            <line x1="12" y1="21" x2="12" y2="23"></line>
            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
            <line x1="1" y1="12" x2="3" y2="12"></line>
            <line x1="21" y1="12" x2="23" y2="12"></line>
            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
        </svg>
        <svg id="moon-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
        </svg>
    </button>
    <!-- 플로팅 버튼 제거됨 (헤더 내부로 이동) -->
    <!-- 메뉴 화면 (초기 로드 시 표시) -->
    <div id="menu-view" class="view">
        <div class="menu-container">
            <h1>내 프로젝트</h1>
            <ul id="project-list">
                <!-- 프로젝트 목록이 여기에 동적으로 로드됩니다 -->
            </ul>
            <button id="create-project-btn" class="primary-btn">새 프로젝트 생성</button>
            <button id="global-directives-btn" class="secondary-btn" style="margin-top: 12px; margin-left: 0;">전역 지시
                프롬프트 설정</button>
        </div>
    </div>

    <!-- 프로젝트 상세 뷰 -->
    <div id="project-detail-view" class="view hidden">
        <div class="project-detail-container">
            <header class="project-detail-header">
                <button id="back-to-menu-from-detail" class="back-link">← 프로젝트 목록으로</button>
                <div class="project-profile-section">
                    <div id="detail-project-thumbnail" class="project-large-thumb"></div>
                    <div class="project-text-info">
                        <h1 id="detail-project-title">프로젝트 이름</h1>
                        <p id="detail-project-description">프로젝트 설명이 여기에 들어갑니다.</p>
                        <div id="detail-project-tags" class="project-tags">
                            <!-- 태그들이 여기에 동적으로 생성됩니다 -->
                        </div>
                        <button id="add-tag-btn" class="add-tag-link">+ 태그 추가</button>
                    </div>
                </div>
            </header>

            <nav class="project-tabs">
                <button class="tab-btn active" data-tab="tab-settings">설정</button>
                <button class="tab-btn" data-tab="tab-background">배경 지식</button>
                <button class="tab-btn" data-tab="tab-characters">등장인물</button>
                <button class="tab-btn" data-tab="tab-relations">관계도</button>
                <button class="tab-btn" data-tab="tab-progression">전개</button>
                <button class="tab-btn" data-tab="tab-foreshadowing">떡밥</button>
                <button class="tab-btn" data-tab="tab-dictionary">고유어 사전</button>
                <button class="tab-btn special-tab" data-tab="tab-writing">회차 쓰기</button>
            </nav>

            <main class="tab-content-container">
                <div id="tab-settings" class="tab-pane active">
                    <div class="settings-form">
                        <div class="settings-section">
                            <h3 class="section-title">핵심 경험 (Core Experience)</h3>
                            <div class="form-group">
                                <label for="proj-setting-emotion">감정</label>
                                <input type="text" id="proj-setting-emotion" placeholder="예: 긴장감, 짜릿함, 카타르시스">
                            </div>
                            <div class="form-group">
                                <label for="proj-setting-gratification">만족감</label>
                                <textarea id="proj-setting-gratification" rows="3"
                                    placeholder="예: 압도적인 성장관, 복수의 쾌감"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="proj-setting-focus">포커스</label>
                                <textarea id="proj-setting-focus" rows="3"
                                    placeholder="예: 주인공의 숨겨진 힘이 드러나는 순간의 주변 반응"></textarea>
                            </div>
                        </div>

                        <div class="settings-section">
                            <h3 class="section-title">문체 및 규칙 (Style & Rules)</h3>
                            <div class="form-group">
                                <label for="proj-setting-pov">기본 시점</label>
                                <textarea id="proj-setting-pov" rows="2"
                                    placeholder="예: 1인칭 주인공 시점, 3인칭 전지적 작가 시점"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="proj-setting-tone">문체</label>
                                <textarea id="proj-setting-tone" rows="3"
                                    placeholder="예: 간결하고 속도감 있는 문체, 화려한 미사여구"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="proj-setting-rules">작성 규칙</label>
                                <textarea id="proj-setting-rules" rows="5"
                                    placeholder="예: 사이다 위주의 전개, 전문 용어 사용 자제"></textarea>
                            </div>
                        </div>
                        <div style="text-align: right; margin-top: 20px;">
                            <button id="save-proj-settings-btn" class="primary-btn"
                                style="width: auto; padding: 12px 30px;">설정 저장하기</button>
                        </div>
                    </div>
                </div>
                <div id="tab-background" class="tab-pane">
                    <div class="settings-form">
                        <div class="settings-section">
                            <h3 class="section-title">세계관 설정</h3>
                            <div class="form-group">
                                <label for="proj-bg-world">시간적/공간적 배경</label>
                                <textarea id="proj-bg-world" rows="4"
                                    placeholder="예: 마나가 깨어난 21세기 현대 판타지 서울, 공중에 떠 있는 섬들의 대륙"></textarea>
                            </div>
                            <div class="form-group">
                                <label>과거 일어난 중요한 사건들</label>
                                <div id="proj-bg-events-list" class="sub-item-list">
                                    <!-- 배경 사건 아이템들이 여기에 렌더링됨 -->
                                </div>
                                <button id="add-proj-bg-event-btn" class="secondary-btn"
                                    style="width: 100%; margin-top: 10px; border-style: dashed;">+ 과거 사건 추가</button>
                            </div>
                        </div>
                        <div style="text-align: right; margin-top: 20px;">
                            <button id="save-proj-bg-btn" class="primary-btn"
                                style="width: auto; padding: 12px 30px;">배경 지식 저장하기</button>
                        </div>
                    </div>
                </div>
                <div id="tab-characters" class="tab-pane">
                    <div class="list-side">
                        <div class="list-header">
                            <h3>등장인물 목록</h3>
                            <button id="add-character-btn" class="primary-btn" style="width: auto; padding: 8px 16px;">+
                                추가</button>
                        </div>
                        <ul id="character-list" class="item-list">
                            <!-- 캐릭터 아이템들이 여기에 렌더링됨 -->
                        </ul>
                    </div>
                </div>
                <div id="tab-relations" class="tab-pane">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; gap: 20px;">
                        <div id="rel-map-search-container" style="position: relative; flex-grow: 1; max-width: 450px;">
                            <div class="inline-input-group">
                                <input type="text" id="rel-map-search-input" placeholder="관계를 확인할 인물 검색...">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: var(--text-secondary);"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                            </div>
                            <ul id="rel-map-search-results" class="dropdown-menu" style="width: 100%; top: 100%; left: 0; right: auto; margin-top: 5px;">
                                <!-- 검색 결과가 여기에 동적으로 추가됨 -->
                            </ul>
                        </div>
                        <button id="rel-map-expand-btn" class="secondary-btn" style="width: auto; padding: 8px 16px; display: flex; align-items: center; gap: 8px; border-radius: 8px;">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 3h6v6M9 21H3v-6M21 3l-7 7M3 21l7-7"/></svg>
                            확대 보기
                        </button>
                    </div>
                    <div id="relationship-map-container" style="width: 100%; height: 600px; border: 1px solid var(--border-color); border-radius: 12px; background: var(--card-bg);">
                        <!-- 관계도 SVG가 여기에 렌더링됩니다. -->
                    </div>
                </div>
                <div id="tab-progression" class="tab-pane">
                    <div class="list-side">
                        <div class="list-header">
                            <h3>전개 목록</h3>
                            <button id="add-progression-btn" class="primary-btn"
                                style="width: auto; padding: 8px 16px;">+
                                추가</button>
                        </div>
                        <ul id="progression-list" class="item-list">
                            <!-- 전개 아이템들이 여기에 렌더링됨 -->
                        </ul>
                    </div>
                </div>
                <div id="tab-foreshadowing" class="tab-pane">
                    <div class="list-side">
                        <div class="list-header">
                            <h3>떡밥 목록</h3>
                            <button id="add-foreshadowing-btn" class="primary-btn"
                                style="width: auto; padding: 8px 16px;">+
                                추가</button>
                        </div>
                        <ul id="foreshadowing-list" class="item-list">
                            <!-- 떡밥 아이템들이 여기에 렌더링됨 -->
                        </ul>
                    </div>
                </div>
                <div id="tab-dictionary" class="tab-pane">
                    <div class="list-side">
                        <div class="list-header">
                            <h3>고유어 사전 목록</h3>
                            <div style="display: flex; gap: 10px; align-items: center;">
                                <button id="edit-dict-category-btn" class="secondary-btn"
                                    style="width: auto; padding: 8px 16px; font-size: 0.9rem;">카테고리 수정</button>
                                <button id="add-dict-btn" class="primary-btn" style="width: auto; padding: 8px 16px;">+
                                    추가</button>
                            </div>
                        </div>
                        <ul id="dict-list" class="item-list">
                            <!-- 고유어 아이템들이 여기에 렌더링됨 -->
                        </ul>
                    </div>
                </div>
                <div id="tab-writing" class="tab-pane">
                    <div class="settings-form">
                        <div class="settings-section">
                            <h3 class="section-title">회차 작성 설정</h3>
                            <div class="form-group">
                                <label for="writing-episode">회차</label>
                                <input type="text" id="writing-episode" placeholder="예: 1화, 프롤로그">
                            </div>
                            <div class="form-group">
                                <label for="writing-goal">재미 목표</label>
                                <textarea id="writing-goal" rows="3" placeholder="이번 회차에서 독자가 느껴야 할 핵심 재미"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="writing-progression">전개</label>
                                <textarea id="writing-progression" rows="5" placeholder="이번 회차의 주요 사건 흐름"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="writing-foreshadowing">떡밥</label>
                                <textarea id="writing-foreshadowing" rows="3" placeholder="이번 회차에서 회수하거나 새로 던질 떡밥"></textarea>
                            </div>
                        </div>
                        <div style="text-align: right; margin-top: 20px; display: flex; justify-content: flex-end; gap: 10px;">
                            <button id="reset-writing-btn" class="secondary-btn"
                                style="width: auto; padding: 12px 30px;">초기화</button>
                            <button id="save-writing-btn" class="primary-btn"
                                style="width: auto; padding: 12px 30px;">저장하기</button>
                        </div>
                    </div>
                </div>
            </main>
        </div>

    </div>



    <!-- 등장인물 상세 패널 -->
    <div id="character-detail-panel" class="detail-side hidden">
        <div class="detail-header" style="justify-content: space-between; gap: 15px;">
            <h3 style="margin: 0;">인물 프로필 설정</h3>
            <div style="display: flex; align-items: center; gap: 10px;">
                <button id="panel-expand-btn" title="확대/축소">
                    <svg id="expand-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <polyline points="15 3 21 3 21 9"></polyline>
                        <polyline points="9 21 3 21 3 15"></polyline>
                        <line x1="21" y1="3" x2="14" y2="10"></line>
                        <line x1="3" y1="21" x2="10" y2="14"></line>
                    </svg>
                    <svg id="shrink-icon" class="hidden" xmlns="http://www.w3.org/2000/svg" width="20" height="20"
                        viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <polyline points="4 14 10 14 10 20"></polyline>
                        <polyline points="20 10 14 10 14 4"></polyline>
                        <line x1="14" y1="10" x2="21" y2="3"></line>
                        <line x1="10" y1="14" x2="3" y2="21"></line>
                    </svg>
                </button>
                <button id="panel-close-btn" title="닫기">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
        </div>
        <div class="form-container" style="max-height: calc(100vh - 100px); overflow-y: auto; padding-right: 15px;">
            <!-- 섹션 1: 기본 정보 -->
            <div class="settings-section">
                <h3 class="section-title">기본 정보</h3>
                <div class="form-group">
                    <label for="char-name">이름 (필수)</label>
                    <input type="text" id="char-name" placeholder="인물 이름">
                </div>
                <div class="grid-form">
                    <div class="form-group">
                        <label for="char-gender">성별</label>
                        <input type="text" id="char-gender" placeholder="예: 남성, 여성, 불명">
                    </div>
                    <div class="form-group">
                        <label for="char-role">역할</label>
                        <input type="text" id="char-role" placeholder="예: 주인공, 조연, 악역">
                    </div>
                </div>
                <div class="form-group">
                    <label for="char-race">종족</label>
                    <input type="text" id="char-race" placeholder="예: 인간, 하이엘프, 드래곤">
                </div>
                <div class="form-group">
                    <label for="char-origin">출신</label>
                    <textarea id="char-origin" rows="2" placeholder="태생, 소속 길드, 고향 등"></textarea>
                </div>
            </div>

            <!-- 섹션 2: 외형 및 특성 -->
            <div class="settings-section">
                <h3 class="section-title">외형 및 특성</h3>
                <div class="form-group">
                    <label for="char-appearance">외형 설명</label>
                    <textarea id="char-appearance" rows="6" placeholder="키, 체격, 눈매, 머리색, 옷차림 등"></textarea>
                </div>
                <div class="form-group">
                    <label for="char-features">특징</label>
                    <textarea id="char-features" rows="4" placeholder="흉터, 문신, 특이한 신체적 특징"></textarea>
                </div>
                <div class="form-group">
                    <label for="char-abilities">능력/기술</label>
                    <textarea id="char-abilities" rows="6" placeholder="고유 스킬, 마법, 초능력 등 자원을 사용하는 능력"></textarea>
                </div>
            </div>

            <!-- 섹션 3: 성격 및 동기 -->
            <div class="settings-section">
                <h3 class="section-title">성격 및 동기</h3>
                <div class="form-group">
                    <label for="char-personality-ext">외적 성격</label>
                    <textarea id="char-personality-ext" rows="4" placeholder="타인에게 보여지는 모습 (예: 쾌활함, 냉철함)"></textarea>
                </div>
                <div class="form-group">
                    <label for="char-personality-int">내적 성격</label>
                    <textarea id="char-personality-int" rows="4" placeholder="속마음, 본성 (예: 사실은 겁이 많음)"></textarea>
                </div>
                <div class="form-group">
                    <label for="char-motivation">행동 동기</label>
                    <textarea id="char-motivation" rows="4" placeholder="무엇을 위해 움직이는가? (예: 복수, 돈, 생존)"></textarea>
                </div>
            </div>

            <!-- 섹션 4: 말투 및 행동 패턴 -->
            <div class="settings-section">
                <h3 class="section-title">말투 및 행동 패턴</h3>
                <div class="form-group">
                    <label for="char-speech-tone">말투 (톤)</label>
                    <textarea id="char-speech-tone" rows="4" placeholder="예: 정중한 다나까체, 거친 비속어, 나른한 말투"></textarea>
                </div>
                <div class="form-group">
                    <label>대사 예시</label>
                    <div id="char-speech-examples-list" class="sub-item-list">
                        <!-- 대사 예시 리스트가 여기에 동적으로 추가됩니다 -->
                    </div>
                    <div class="inline-input-group">
                        <input type="text" id="add-speech-example-input" placeholder="새로운 대사 예시를 입력하세요">
                        <button id="add-speech-example-btn" class="add-tag-link" style="padding: 0 15px;">추가</button>
                    </div>
                </div>
                <div class="form-group">
                    <label for="char-behavior-habits">평소 습관</label>
                    <textarea id="char-behavior-habits" rows="4" placeholder="생각할 때 입술을 깨묾, 항상 동전을 만짐 등"></textarea>
                </div>
                <div class="form-group">
                    <label for="char-behavior-reactions">위기/특정 상황 행동</label>
                    <textarea id="char-behavior-reactions" rows="4"
                        placeholder="공황 상태일 때의 반응, 누군가 죽었을 때의 반응"></textarea>
                </div>
                <div class="form-group">
                    <label for="char-behavior-combat">전투 패턴/기술</label>
                    <textarea id="char-behavior-combat" rows="4" placeholder="전투 시의 선호 전략이나 필살기 사용 타이밍"></textarea>
                </div>
            </div>

            <!-- 섹션 5: 선호 및 과거사 -->
            <div class="settings-section">
                <h3 class="section-title">선호 및 과거사</h3>
                <div class="form-group">
                    <label>좋아하는 것</label>
                    <div id="char-likes-list" class="sub-item-list">
                        <!-- 좋아하는 것 리스트 -->
                    </div>
                    <div class="inline-input-group">
                        <input type="text" id="add-like-input" placeholder="좋아하는 것을 입력하세요">
                        <button id="add-like-btn" class="add-tag-link" style="padding: 0 15px;">추가</button>
                    </div>
                </div>
                <div class="form-group">
                    <label>싫어하는 것</label>
                    <div id="char-dislikes-list" class="sub-item-list">
                        <!-- 싫어하는 것 리스트 -->
                    </div>
                    <div class="inline-input-group">
                        <input type="text" id="add-dislike-input" placeholder="싫어하는 것을 입력하세요">
                        <button id="add-dislike-btn" class="add-tag-link" style="padding: 0 15px;">추가</button>
                    </div>
                </div>
                <div class="form-group">
                    <label>과거 주요 사건 리스트</label>
                    <div id="char-past-events-list" class="sub-item-list">
                        <!-- 과거 사건 아이템들이 여기에 렌더링됨 -->
                    </div>
                    <button id="add-past-event-btn" class="secondary-btn"
                        style="width: 100%; margin-top: 10px; border-style: dashed;">+ 과거 사건 추가</button>
                </div>
            </div>

            <div class="modal-footer" style="margin-top: 30px; padding-bottom: 50px;">
                <button id="save-character-btn" class="primary-btn">인물 정보 저장</button>
                <button id="delete-character-btn" class="secondary-btn" style="color: #ef4444;">삭제</button>
            </div>
        </div>
    </div>

    <!-- 전개 상세 패널 -->
    <div id="progression-detail-panel" class="detail-side hidden">
        <div class="detail-header" style="justify-content: space-between; gap: 15px;">
            <h3 style="margin: 0;">전개 설정</h3>
            <div style="display: flex; align-items: center; gap: 10px;">
                <button id="prog-panel-expand-btn" title="확대/축소">
                    <svg id="prog-expand-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20"
                        viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <polyline points="15 3 21 3 21 9"></polyline>
                        <polyline points="9 21 3 21 3 15"></polyline>
                        <line x1="21" y1="3" x2="14" y2="10"></line>
                        <line x1="3" y1="21" x2="10" y2="14"></line>
                    </svg>
                    <svg id="prog-shrink-icon" class="hidden" xmlns="http://www.w3.org/2000/svg" width="20" height="20"
                        viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <polyline points="4 14 10 14 10 20"></polyline>
                        <polyline points="20 10 14 10 14 4"></polyline>
                        <line x1="14" y1="10" x2="21" y2="3"></line>
                        <line x1="10" y1="14" x2="3" y2="21"></line>
                    </svg>
                </button>
                <button id="prog-panel-close-btn" title="닫기">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
        </div>
        <div class="form-container" style="max-height: calc(100vh - 100px); overflow-y: auto; padding-right: 15px;">
            <div class="settings-section">
                <h3 class="section-title">회차 정보</h3>
                <div class="form-group">
                    <label>화수</label>
                    <div id="prog-episode-display"
                        style="padding: 10px; background: var(--secondary-color); border-radius: 4px; font-weight: bold; color: var(--primary-color);">
                        1화 (자동 배정)</div>
                </div>
                <div class="form-group">
                    <label for="prog-summary">내용 요약</label>
                    <textarea id="prog-summary" rows="6" placeholder="해당 화의 핵심 내용을 요약해주세요."></textarea>
                </div>
                <div class="form-group">
                    <label for="prog-points">중요 포인트</label>
                    <textarea id="prog-points" rows="6"
                        placeholder="해당 화에서 놓치지 말아야 할 복선, 갈등, 강화 요소 등을 적어주세요."></textarea>
                </div>
            </div>

            <div class="modal-footer" style="margin-top: 30px; padding-bottom: 50px;">
                <button id="save-progression-btn" class="primary-btn">전개 정보 저장</button>
                <button id="delete-progression-btn" class="secondary-btn" style="color: #ef4444;">삭제</button>
            </div>
        </div>
    </div>

    <!-- 떡밥 상세 패널 -->
    <div id="foreshadowing-detail-panel" class="detail-side hidden">
        <div class="detail-header" style="justify-content: space-between; gap: 15px;">
            <h3 style="margin: 0;">떡밥 설정</h3>
            <div style="display: flex; align-items: center; gap: 10px;">
                <button id="foreshadowing-panel-expand-btn" title="확대/축소">
                    <svg id="foreshadowing-expand-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20"
                        viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <polyline points="15 3 21 3 21 9"></polyline>
                        <polyline points="9 21 3 21 3 15"></polyline>
                        <line x1="21" y1="3" x2="14" y2="10"></line>
                        <line x1="3" y1="21" x2="10" y2="14"></line>
                    </svg>
                    <svg id="foreshadowing-shrink-icon" class="hidden" xmlns="http://www.w3.org/2000/svg" width="20"
                        height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="4 14 10 14 10 20"></polyline>
                        <polyline points="20 10 14 10 14 4"></polyline>
                        <line x1="14" y1="10" x2="21" y2="3"></line>
                        <line x1="10" y1="14" x2="3" y2="21"></line>
                    </svg>
                </button>
                <button id="foreshadowing-panel-close-btn" title="닫기">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
        </div>
        <div class="form-container" style="max-height: calc(100vh - 100px); overflow-y: auto; padding-right: 15px;">
            <div class="settings-section">
                <h3 class="section-title">떡밥 정보</h3>
                <div class="form-group">
                    <label for="foreshadowing-name">명칭 (필수)</label>
                    <input type="text" id="foreshadowing-name" placeholder="떡밥을 식별할 명칭">
                </div>
                <div class="form-group">
                    <label for="foreshadowing-hidden-fact">숨겨진 사실</label>
                    <textarea id="foreshadowing-hidden-fact" rows="4" placeholder="이 떡밥이 드러낼 진실 혹은 반전"></textarea>
                </div>
                <div class="form-group">
                    <label for="foreshadowing-clue">단서</label>
                    <textarea id="foreshadowing-clue" rows="6"
                        placeholder="독자나 주인공에게 주어질 단서들. 여러 개라면 목록으로 작성"></textarea>
                </div>
                <div class="form-group">
                    <label for="foreshadowing-reveal-timing">공개 타이밍</label>
                    <input type="text" id="foreshadowing-reveal-timing" placeholder="예: 150화, 최종장, 외전">
                </div>
            </div>

            <div class="modal-footer" style="margin-top: 30px; padding-bottom: 50px;">
                <button id="save-foreshadowing-btn" class="primary-btn">떡밥 정보 저장</button>
                <button id="delete-foreshadowing-btn" class="secondary-btn" style="color: #ef4444;">삭제</button>
            </div>
        </div>
    </div>

    <!-- 고유어 상세 패널 -->
    <div id="dict-detail-panel" class="detail-side hidden">
        <div class="detail-header" style="justify-content: space-between; gap: 15px;">
            <h3 style="margin: 0;">고유어 설정</h3>
            <div style="display: flex; align-items: center; gap: 10px;">
                <button id="dict-panel-expand-btn" title="확대/축소">
                    <svg id="dict-expand-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20"
                        viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <polyline points="15 3 21 3 21 9"></polyline>
                        <polyline points="9 21 3 21 3 15"></polyline>
                        <line x1="21" y1="3" x2="14" y2="10"></line>
                        <line x1="3" y1="21" x2="10" y2="14"></line>
                    </svg>
                    <svg id="dict-shrink-icon" class="hidden" xmlns="http://www.w3.org/2000/svg" width="20" height="20"
                        viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <polyline points="4 14 10 14 10 20"></polyline>
                        <polyline points="20 10 14 10 14 4"></polyline>
                        <line x1="14" y1="10" x2="21" y2="3"></line>
                        <line x1="10" y1="14" x2="3" y2="21"></line>
                    </svg>
                </button>
                <button id="dict-panel-close-btn" title="닫기">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
        </div>
        <div class="form-container" style="max-height: calc(100vh - 100px); overflow-y: auto; padding-right: 15px;">
            <div class="settings-section">
                <h3 class="section-title">기본 정보</h3>
                <div class="form-group">
                    <label for="dict-name">이름 (필수)</label>
                    <input type="text" id="dict-name" placeholder="고유어 이름">
                </div>
                <div class="form-group">
                    <label for="dict-category">카테고리</label>
                    <select id="dict-category">
                        <!-- 카테고리는 동적으로 로드됩니다. -->
                    </select>
                </div>
                <div class="form-group">
                    <label for="dict-description">상세 설명</label>
                    <textarea id="dict-description" rows="10" placeholder="해당 고유어에 대한 상세 내용을 기록해주세요."></textarea>
                </div>
            </div>

            <div class="modal-footer" style="margin-top: 30px; padding-bottom: 50px;">
                <button id="save-dict-btn" class="primary-btn">고유어 저장</button>
                <button id="delete-dict-btn" class="secondary-btn" style="color: #ef4444;">삭제</button>
            </div>
        </div>
    </div>

    <!-- 관계 상세 패널 -->
    <div id="relationship-detail-panel" class="detail-side hidden">
        <div class="detail-header" style="justify-content: space-between; gap: 15px;">
            <h3 style="margin: 0;">관계 설정</h3>
            <div style="display: flex; align-items: center; gap: 10px;">
                <button id="rel-panel-expand-btn" title="확대/축소">
                    <svg id="rel-expand-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20"
                        viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <polyline points="15 3 21 3 21 9"></polyline>
                        <polyline points="9 21 3 21 3 15"></polyline>
                        <line x1="21" y1="3" x2="14" y2="10"></line>
                        <line x1="3" y1="21" x2="10" y2="14"></line>
                    </svg>
                    <svg id="rel-shrink-icon" class="hidden" xmlns="http://www.w3.org/2000/svg" width="20" height="20"
                        viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <polyline points="4 14 10 14 10 20"></polyline>
                        <polyline points="20 10 14 10 14 4"></polyline>
                        <line x1="14" y1="10" x2="21" y2="3"></line>
                        <line x1="10" y1="14" x2="3" y2="21"></line>
                    </svg>
                </button>
                <button id="rel-panel-close-btn" title="닫기">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
        </div>
        <div class="form-container" style="max-height: calc(100vh - 100px); overflow-y: auto; padding-right: 15px;">
            <div class="settings-section">
                <h3 class="section-title">관계 정보</h3>
                <div class="form-group">
                    <label>대상 인물</label>
                    <div id="rel-characters-display" style="padding: 10px; background: var(--secondary-color); border-radius: 4px; font-weight: bold; color: var(--primary-color);">인물 A ↔ 인물 B</div>
                </div>
                <div class="form-group">
                    <label for="rel-label">관계 명칭 (필수)</label>
                    <input type="text" id="rel-label" placeholder="예: 친구, 원수, 연인">
                </div>
                <div class="form-group">
                    <label for="rel-feelings">서로에 대한 감정</label>
                    <textarea id="rel-feelings" rows="4" placeholder="서로를 어떻게 생각하는지 적어주세요."></textarea>
                </div>
                <div class="form-group">
                    <label for="rel-past">공유하는 과거</label>
                    <textarea id="rel-past" rows="6" placeholder="두 인물이 함께 겪은 중요한 사건이나 과거사를 적어주세요."></textarea>
                </div>
                <div class="form-group">
                    <label for="rel-speech">대화할 때 말투</label>
                    <textarea id="rel-speech" rows="4" placeholder="두 사람이 대화할 때의 특징적인 말투나 호칭 등을 적어주세요."></textarea>
                </div>
            </div>

            <div class="modal-footer" style="margin-top: 30px; padding-bottom: 50px;">
                <button id="save-relationship-btn" class="primary-btn">관계 정보 저장</button>
                <button id="delete-relationship-btn" class="secondary-btn" style="color: #ef4444;">삭제</button>
            </div>
        </div>
    </div>

    <!-- 설정 버튼 (화면 전체 고정 위치) -->
    <button id="settings-open-btn" title="설정 열기">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path
                d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z">
            </path>
            <circle cx="12" cy="12" r="3"></circle>
        </svg>
    </button>

    <!-- 설정 패널 -->
    <div id="settings-panel">
        <div class="settings-header"
            style="display: flex; justify-content: space-between; align-items: center; padding: 20px; border-bottom: 1px solid var(--border-color);">
            <h2 style="margin: 0;">설정</h2>
            <button id="settings-close-btn-inner" title="닫기"
                style="background: none; border: 1px solid var(--border-color); width: 36px; height: 36px; border-radius: 8px; display: flex; justify-content: center; align-items: center; cursor: pointer; color: var(--text-secondary);">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
        </div>
        <div class="settings-content">
            <div class="setting-item">
                <label for="setting-bg-color">에디터 배경색</label>
                <input type="color" id="setting-bg-color">
            </div>
            <div class="setting-item">
                <label for="setting-font-color">에디터 글자색</label>
                <input type="color" id="setting-font-color">
            </div>
            <div class="setting-item">
                <label for="setting-font-size-range">글자 크기 (px)</label>
                <div class="font-size-container">
                    <input type="range" id="setting-font-size-range" min="12" max="100" step="1">
                    <input type="number" id="setting-font-size-number" min="12" max="100">
                </div>
            </div>
            <div class="setting-item">
                <label for="setting-font-family">폰트</label>
                <select id="setting-font-family">
                    <option value="'Noto Serif CJK KR', serif">Noto Serif CJK KR (명조)</option>
                    <option value="'Noto Sans CJK KR', sans-serif">Noto Sans CJK KR (고딕)</option>
                    <option value="-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif">
                        기본 시스템 고딕</option>
                    <option value="serif">기본 시스템 명조</option>
                    <option value="monospace">기본 고정폭</option>
                </select>
            </div>
            <button id="save-settings-btn" class="primary-btn">설정 저장</button>
        </div>
    </div>


    <!-- 프로젝트 생성 모달 -->
    <div id="create-project-modal" class="modal">
        <div class="modal-content">
            <h2>새 프로젝트 생성</h2>
            <div class="modal-body">
                <div class="form-group">
                    <label for="new-project-title">제목</label>
                    <input type="text" id="new-project-title" placeholder="소설 제목을 입력하세요">
                </div>
                <div class="form-group">
                    <label for="new-project-description">상세 설명</label>
                    <textarea id="new-project-description" rows="3" placeholder="소설에 대한 간단한 설명을 적어주세요"></textarea>
                </div>
                <div class="form-group">
                    <label for="new-project-tags">태그 (쉼표로 구분)</label>
                    <input type="text" id="new-project-tags" placeholder="판타지, 회귀, 먼치킨">
                </div>
                <div class="form-group">
                    <label for="new-project-thumbnail">썸네일 이미지</label>
                    <input type="file" id="new-project-thumbnail" accept="image/*">
                    <p class="input-help" style="font-size: 0.8rem; color: #888; margin-top: 5px;">선택하지 않으면 검은색 배경이
                        적용됩니다.</p>
                </div>
            </div>
            <div class="modal-footer">
                <button id="modal-create-btn" class="primary-btn">생성하기</button>
                <button id="modal-cancel-btn" class="secondary-btn">취소</button>
            </div>
        </div>
    </div>

    <!-- 오버레이 -->
    <div id="overlay"></div>

    <!-- 관계도 전체 화면 오버레이 -->
    <div id="rel-map-fullscreen-overlay" class="hidden" style="position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: var(--bg-color); z-index: 9999; display: flex; flex-direction: column;">
        <div style="padding: 15px 25px; display: flex; justify-content: space-between; align-items: center; background: var(--card-bg); border-bottom: 1px solid var(--border-color); box-shadow: var(--shadow); gap: 20px;">
            <h3 style="margin: 0; color: var(--primary-color); white-space: nowrap;">관계도 전체 화면</h3>
            
            <div id="rel-map-fs-search-container" style="position: relative; flex-grow: 1; max-width: 600px;">
                <div class="inline-input-group">
                    <input type="text" id="rel-map-fs-search-input" placeholder="이동할 인물 이름을 입력하세요...">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: var(--text-secondary);"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                </div>
                <ul id="rel-map-fs-search-results" class="dropdown-menu" style="width: 100%; top: 100%; left: 0; right: auto; margin-top: 5px;">
                    <!-- 검색 결과가 여기에 동적으로 추가됨 -->
                </ul>
            </div>

            <button id="rel-map-shrink-btn" class="secondary-btn" style="width: auto; padding: 8px 16px; display: flex; align-items: center; gap: 8px; border-radius: 8px;">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 14h6v6M20 10h-6V4M14 10l7-7M10 14l-7 7"/></svg>
                축소하기
            </button>
        </div>
        <div id="relationship-map-fullscreen-container" style="flex-grow: 1; width: 100%; height: 100%;">
            <!-- 여기에 관계도가 다시 그려집니다 -->
        </div>
    </div>

    <!-- 전역 지시 프롬프트 설정 모달 -->
    <div id="global-settings-modal" class="modal">
        <div class="modal-content" style="max-width: 700px;">
            <h2>전역 지시 프롬프트 설정</h2>
            <div class="form-container">
                <div class="settings-section">
                    <h3 class="section-title">Prompt Request</h3>
                    <div class="form-group">
                        <label for="global-command">명령 (Command)</label>
                        <textarea id="global-command" rows="2" placeholder="예: 소설 본문을 작성하라"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="global-instruction">지침 (Instruction)</label>
                        <textarea id="global-instruction" rows="3" placeholder="예: 이전 줄거리를 분석하여 전개하라"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="global-output-requirements">출력 요구사항</label>
                        <textarea id="global-output-requirements" rows="2"
                            placeholder="예: JSON 형식을 제외하고 텍스트만 출력"></textarea>
                    </div>
                </div>

                <div class="settings-section">
                    <h3 class="section-title">AI Meta</h3>
                    <div class="form-group">
                        <label for="global-role">역할 (Role)</label>
                        <input type="text" id="global-role" placeholder="예: 웹소설 전문 작가">
                    </div>
                    <div class="form-group">
                        <label for="global-task">임무 (Task)</label>
                        <input type="text" id="global-task" placeholder="예: 소설 텍스트 생성">
                    </div>
                    <div class="form-group">
                        <label for="global-directives">상세 지시사항</label>
                        <textarea id="global-directives" rows="4" placeholder="기타 세부 지시사항을 입력하세요"></textarea>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="global-settings-reset-btn" class="reset-btn" style="margin-right: auto;">기본값으로 초기화</button>
                <button id="global-settings-save-btn" class="primary-btn">저장하기</button>
                <button id="global-settings-cancel-btn" class="secondary-btn">취소</button>
            </div>
        </div>
    </div>
    <!-- 과거 사건 입력 모달 -->
    <div id="past-event-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>과거 사건 기록</h2>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="event-summary">과거 사건 요약</label>
                    <textarea id="event-summary" rows="2" placeholder="사건의 핵심 내용을 한 줄로 요약해주세요."></textarea>
                </div>
                <div class="form-group">
                    <label for="event-detail">결정적 사건 상세</label>
                    <textarea id="event-detail" rows="6" placeholder="사건이 발생한 경위와 구체적인 내용을 상세히 기록해주세요."></textarea>
                </div>
                <div class="form-group">
                    <label for="event-impact">현재에 미치는 영향</label>
                    <textarea id="event-impact" rows="4"
                        placeholder="이 과거 사건이 현재 캐릭터의 성격, 가치관, 트라우마 등에 어떤 영향을 주었나요?"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button id="save-past-event-modal-btn" class="primary-btn">리스트에 추가</button>
                <button class="secondary-btn cancel-modal">취소</button>
            </div>
        </div>
    </div>

    <!-- 배경 사건 입력 모달 -->
    <div id="proj-bg-event-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>배경 사건 기록</h2>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="proj-bg-event-time">시간대</label>
                    <input type="text" id="proj-bg-event-time" placeholder="예: 10년 전, 고대 왕국 시절">
                </div>
                <div class="form-group">
                    <label for="proj-bg-event-name">사건 이름 (필수)</label>
                    <input type="text" id="proj-bg-event-name" placeholder="예: 대균열, 암흑의 날">
                </div>
                <div class="form-group">
                    <label for="proj-bg-event-detail">사건 상세 내용</label>
                    <textarea id="proj-bg-event-detail" rows="5"
                        placeholder="사건이 발생한 경위와 구체적인 내용을 상세히 기록해주세요."></textarea>
                </div>
                <div class="form-group">
                    <label for="proj-bg-event-impact">현재에 미치는 영향</label>
                    <textarea id="proj-bg-event-impact" rows="3"
                        placeholder="이 사건이 현재 세계관이나 스토리에 어떤 영향을 주었나요?"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button id="save-proj-bg-event-modal-btn" class="primary-btn">리스트에 추가</button>
                <button class="secondary-btn cancel-modal">취소</button>
            </div>
        </div>
    </div>


    <!-- 고유어 카테고리 관리 모달 -->
    <div id="dict-category-modal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <h2>카테고리 관리</h2>
            <div class="modal-body">
                <div class="form-group">
                    <label for="dict-category-input">카테고리 이름</label>
                    <div class="inline-input-group">
                        <input type="text" id="dict-category-input" placeholder="새 카테고리 추가 또는 이름 수정">
                        <button id="save-dict-category-btn" class="primary-btn"
                            style="width: auto; padding: 0 20px; font-size: 0.9rem;">추가</button>
                    </div>
                </div>
                <div class="settings-section" style="margin-top: 30px; padding-top: 20px;">
                    <h3 class="section-title" style="margin-bottom: 20px;">카테고리 목록</h3>
                    <ul id="dict-category-list" class="category-list" style="list-style: none; padding: 0;">
                        <!-- 카테고리 목록이 여기에 동적으로 렌더링됩니다. -->
                    </ul>
                </div>
            </div>
            <div class="modal-footer">
                <button id="close-dict-category-modal-btn" class="secondary-btn">닫기</button>
            </div>
        </div>
    </div>
    <script src="js/relationship-map.js" type="module"></script>
    <script src="js/app.js" type="module"></script>
</body>

</html>